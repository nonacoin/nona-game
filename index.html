<!DOCTYPE html>
<html>
<head>
    <title>ØªØ³Øª Ø³ÙˆÙ¾Ø§</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
</head>
<body>
    <h1>ØªØ³Øª Ø§ØªØµØ§Ù„ Ø³ÙˆÙ¾Ø§</h1>
    <div>
        <button onclick="testConnection()">ØªØ³Øª Ø§ØªØµØ§Ù„</button>
        <button onclick="readData()">Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡</button>
        <button onclick="writeTest()">Ù†ÙˆØ´ØªÙ† ØªØ³Øª</button>
    </div>
    <div id="output"></div>

    <script>
        // ğŸ”´ Ú©Ù„ÛŒØ¯ Ø²ÛŒØ± Ø±Ø§ REPLACE Ú©Ù†ÛŒØ¯:
        // 1. Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Supabase Ø¨Ø±ÙˆÛŒØ¯
        // 2. Settings > API
        // 3. Ø§Ø² Ø¨Ø®Ø´ "Project API keys" ÛŒÚ©ÛŒ Ø§Ø² Ú©Ù„ÛŒØ¯Ù‡Ø§ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯
        // 4. ÛŒØ§ RLS Ø±Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ (Authentication > Policies)
        
        const supabaseUrl = 'https://xouwoemiyxnugontsles.supabase.co';
        
        // Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ (ÛŒÚ©ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯):
        // a) Ø§Ú¯Ø± RLS ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯ØŒ Ø§Ø² Ù‡Ù…Ø§Ù† Ú©Ù„ÛŒØ¯ Ù‚Ø¨Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
        // b) Ø§Ú¯Ø± RLS ÙØ¹Ø§Ù„ Ø§Ø³ØªØŒ Ø§Ø² Service Role Key Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (Ù…Ø®ÙÛŒ!)
        const supabaseKey = 'Ú©Ù„ÛŒØ¯-Ø¬Ø¯ÛŒØ¯-Ø§ÛŒÙ†Ø¬Ø§-Ù‚Ø±Ø§Ø±-Ú¯ÛŒØ±Ø¯'; // ğŸ”´ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯
        
        if (typeof supabase === 'undefined') {
            document.getElementById('output').innerHTML = 
                'âŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Supabase Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯.';
        } else {
            const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
            
            function testConnection() {
                document.getElementById('output').innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§ØªØµØ§Ù„...';
                supabaseClient.from('game_rooms_v0').select('*', { count: 'exact', head: true })
                    .then(response => {
                        if (response.error) {
                            document.getElementById('output').innerHTML = 
                                'âŒ Ø®Ø·Ø§: ' + response.error.message + 
                                '<br><br>ğŸ”§ Ø±Ø§Ù‡â€ŒØ­Ù„:<br>' +
                                '1. Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Supabase Ø¨Ø±ÙˆÛŒØ¯<br>' +
                                '2. Authentication > Policies<br>' +
                                '3. RLS Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯<br>' +
                                '4. ÛŒØ§ Ø§Ø² Service Role Key Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯';
                        } else {
                            document.getElementById('output').innerHTML = 
                                'âœ… Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚<br>ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§: ' + response.count;
                        }
                    });
            }
            
            // ØªÙˆØ§Ø¨Ø¹ readData Ùˆ writeTest Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯
            function readData() {
                document.getElementById('output').innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ Ø®ÙˆØ§Ù†Ø¯Ù†...';
                Promise.all([
                    supabaseClient.from('game_rooms_v0').select('*').limit(5),
                    supabaseClient.from('game_room_players_v0').select('*').limit(5)
                ])
                .then(([rooms, players]) => {
                    let html = '<h3>Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡:</h3>';
                    html += rooms.data ? `<h4>Ø§ØªØ§Ù‚â€ŒÙ‡Ø§ (${rooms.data.length}):</h4><pre>${JSON.stringify(rooms.data,null,2)}</pre>` : 'Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† Ø§ØªØ§Ù‚â€ŒÙ‡Ø§';
                    html += players.data ? `<h4>Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† (${players.data.length}):</h4><pre>${JSON.stringify(players.data,null,2)}</pre>` : 'Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†';
                    document.getElementById('output').innerHTML = html;
                });
            }
            
            function writeTest() {
                document.getElementById('output').innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ† Ø¯Ø§Ø¯Ù‡ ØªØ³Øª...';
                const testRoom = {
                    room_code: 'TEST_' + Math.random().toString(36).substr(2, 5).toUpperCase(),
                    room_status: 'waiting',
                    debug_note: 'ØªØ³Øª Ø§Ø² ØµÙØ­Ù‡ HTML - ' + new Date().toLocaleString('fa-IR')
                };
                
                supabaseClient.from('game_rooms_v0')
                    .insert([testRoom])
                    .select()
                    .then(response => {
                        if (response.error) {
                            document.getElementById('output').innerHTML = 
                                'âŒ Ø®Ø·Ø§ Ø¯Ø± Ù†ÙˆØ´ØªÙ†: ' + response.error.message;
                        } else {
                            document.getElementById('output').innerHTML = 
                                'âœ… Ù†ÙˆØ´ØªÙ† Ù…ÙˆÙÙ‚<br>Ø¯Ø§Ø¯Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡:<br><pre>' + 
                                JSON.stringify(response.data[0], null, 2) + '</pre>';
                        }
                    });
            }
            
            document.getElementById('output').innerHTML = 
                'âœ… Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.<br>' +
                'âš ï¸ Ø§Ú¯Ø± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø®Ø·Ø§ÛŒ 401 Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ØŒ Ú©Ù„ÛŒØ¯ API Ø±Ø§ Ø¯Ø± Ø®Ø· 26 Ú©Ø¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯.';
        }
    </script>
</body>
</html>
