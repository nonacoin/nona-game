<!DOCTYPE html>
<html>
<head>
    <title>ØªØ³Øª Ø³ÙˆÙ¾Ø§</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
</head>
<body>
    <h1>ØªØ³Øª Ø§ØªØµØ§Ù„ Ø³ÙˆÙ¾Ø§</h1>
    <div>
        <button onclick="testConnection()">Test Connection</button>
        <button onclick="readData()">Read Data</button>
        <button onclick="writeTest()">Write Test</button>
    </div>
    <div id="output">Loading Supabase library...</div>

    <script>
        const supabaseUrl = 'https://xouwoemiyxnugontsles.supabase.co';
        // ðŸ”´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÙˆÙ‚Øª Ø§Ø² Service Role Key ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª
        const supabaseKey = 'sb_secret_cFMezy39Q6foSYaR2IVYjw_wBVoCsAY';
        
        if (typeof supabase === 'undefined') {
            document.getElementById('output').innerHTML = 'ERROR: Supabase library failed to load';
        } else {
            const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
            
            function testConnection() {
                document.getElementById('output').innerHTML = 'Testing connection...';
                supabaseClient.from('game_rooms_v0')
                    .select('*', { count: 'exact', head: true })
                    .then(response => {
                        if (response.error) {
                            document.getElementById('output').innerHTML = 
                                'ERROR: ' + response.error.message + 
                                '<br><br>SOLUTION:<br>' +
                                '1. Go to Supabase project<br>' +
                                '2. Authentication > Policies<br>' +
                                '3. Disable RLS for tables<br>' +
                                '4. Or check API key';
                        } else {
                            document.getElementById('output').innerHTML = 
                                'SUCCESS: Connected<br>Record count: ' + response.count;
                        }
                    })
                    .catch(error => {
                        document.getElementById('output').innerHTML = 'ERROR: ' + error.message;
                    });
            }
            
            function readData() {
                document.getElementById('output').innerHTML = 'Reading data...';
                Promise.all([
                    supabaseClient.from('game_rooms_v0').select('*').limit(3),
                    supabaseClient.from('game_room_players_v0').select('*').limit(3)
                ])
                .then(([rooms, players]) => {
                    let html = '<h3>Data Read:</h3>';
                    
                    if (rooms.error) {
                        html += '<p style="color:red">Rooms error: ' + rooms.error.message + '</p>';
                    } else {
                        html += '<h4>Rooms (' + rooms.data.length + '):</h4>';
                        html += '<pre>' + JSON.stringify(rooms.data, null, 2) + '</pre>';
                    }
                    
                    if (players.error) {
                        html += '<p style="color:red">Players error: ' + players.error.message + '</p>';
                    } else {
                        html += '<h4>Players (' + players.data.length + '):</h4>';
                        html += '<pre>' + JSON.stringify(players.data, null, 2) + '</pre>';
                    }
                    
                    document.getElementById('output').innerHTML = html;
                })
                .catch(error => {
                    document.getElementById('output').innerHTML = 'ERROR: ' + error.message;
                });
            }
            
            function writeTest() {
                document.getElementById('output').innerHTML = 'Writing test data...';
                
                const testRoom = {
                    room_code: 'TEST_' + Math.random().toString(36).substr(2, 5).toUpperCase(),
                    room_status: 'waiting',
                    debug_note: 'Test from HTML - ' + new Date().toISOString()
                };
                
                supabaseClient.from('game_rooms_v0')
                    .insert([testRoom])
                    .select()
                    .then(response => {
                        if (response.error) {
                            document.getElementById('output').innerHTML = 
                                'WRITE ERROR: ' + response.error.message;
                        } else {
                            document.getElementById('output').innerHTML = 
                                'WRITE SUCCESS<br>Created data:<br><pre>' + 
                                JSON.stringify(response.data[0], null, 2) + '</pre>';
                        }
                    })
                    .catch(error => {
                        document.getElementById('output').innerHTML = 'ERROR: ' + error.message;
                    });
            }
            
            // Auto-test on load
            setTimeout(testConnection, 1000);
        }
    </script>
</body>
</html>
