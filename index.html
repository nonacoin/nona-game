<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dice Party - Ù†Ø³Ø®Ù‡ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯</title>
<style>
    /* ======================================= */
    /* ğŸ¨ Ø¨Ø®Ø´ Ø§Ø³ØªØ§ÛŒÙ„ - Ø¸Ø§Ù‡Ø± Ú©Ù„ÛŒ Ø¨Ø§Ø²ÛŒ           */
    /* ======================================= */
    
    /* Ø¨Ø¯Ù†Ù‡ Ø§ØµÙ„ÛŒ ØµÙØ­Ù‡ */
    body {
        font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
        color: #fff;
        padding: 12px;
        box-sizing: border-box;
        overflow-x: hidden;
    }

    /* Ø°Ø±Ø§Øª Ù…Ø¹Ù„Ù‚ Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.05) 0%, transparent 20%),
            radial-gradient(circle at 80% 70%, rgba(0, 255, 128, 0.05) 0%, transparent 20%);
        z-index: -1;
    }

    /* Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ */
    #game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        max-width: 720px;
        width: 100%;
    }

    /* ======================================= */
    /* ğŸ® Ø¨Ø®Ø´ Ù¾Ù„ÛŒØ±Ù‡Ø§ Ùˆ ØªØ§ÛŒÙ…Ø± - Ø¨Ø§ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ */
    /* ======================================= */
    
    /* Ø±Ø¯ÛŒÙ Ø¨Ø§Ù„Ø§ÛŒÛŒ: Ø¯Ùˆ Ù¾Ù„ÛŒØ± */
        /* Ø±Ø¯ÛŒÙ Ø¨Ø§Ù„Ø§ÛŒÛŒ: Ø¯Ùˆ Ù¾Ù„ÛŒØ± */
    #top-wrapper {
        display: flex;
        gap: 5px;  /* Ø§Ø² 15px Ø¨Ù‡ 5px */
        justify-content: space-between;  /* ØªØºÛŒÛŒØ± Ø¨Ù‡ space-between */
        width: 100%;
        padding: 0 5px;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
    }

    /* Ø¬Ø¹Ø¨Ù‡ Ù‡Ø± Ù¾Ù„ÛŒØ± */
        /* Ø¬Ø¹Ø¨Ù‡ Ù‡Ø± Ù¾Ù„ÛŒØ± */
        /* Ø¬Ø¹Ø¨Ù‡ Ù‡Ø± Ù¾Ù„ÛŒØ± */
    .player-box {
        width: 45%;  /* ØªØºÛŒÛŒØ± Ø§ØµÙ„ÛŒ: Ø§Ø² 192px Ø¨Ù‡ 45% */
        min-width: 130px;  /* Ø­Ø¯Ø§Ù‚Ù„ Ø¹Ø±Ø¶ */
        max-width: 150px;  /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ */
        background: rgba(30, 30, 46, 0.9);
        padding: 8px 10px;  /* Ú©Ø§Ù‡Ø´ Ø¨ÛŒØ´ØªØ± */
        border-radius: 8px;  /* Ú©Ø§Ù‡Ø´ Ø§Ø² 10px */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);  /* Ú©Ø§Ù‡Ø´ */
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 4px;  /* Ú©Ø§Ù‡Ø´ Ø¨ÛŒØ´ØªØ± */
        transition: all 0.3s ease;
    }

    /* Ù¾Ù„ÛŒØ± ÙØ¹Ø§Ù„ (Ù†ÙˆØ¨ØªØ´ Ø§Ø³Øª) */
    .player-box.active-player {
        transform: scale(1.03);
        animation: glowEffect 2s infinite alternate;
    }

    /* Ù¾Ù„ÛŒØ± 1 - Ø±Ù†Ú¯ Ø²Ø±Ø¯ Ø·Ù„Ø§ÛŒÛŒ */
    .player-box.player1 {
        border: 2px solid #FFD700; /* Ø·Ù„Ø§ÛŒÛŒ */
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }
    .player-box.player1.active-player {
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.6);
    }

    /* Ù¾Ù„ÛŒØ± 2 - Ø±Ù†Ú¯ Ø³Ø¨Ø² */
    .player-box.player2 {
        border: 2px solid #00FF7F; /* Ø³Ø¨Ø² Ø¨Ù‡Ø§Ø±ÛŒ */
        box-shadow: 0 0 15px rgba(0, 255, 127, 0.3);
    }
    .player-box.player2.active-player {
        box-shadow: 0 0 25px rgba(0, 255, 127, 0.6);
    }

    /* Ø§ÙÚ©Øª Ø¯Ø±Ø®Ø´Ø´ Ø¨Ø±Ø§ÛŒ Ù¾Ù„ÛŒØ± ÙØ¹Ø§Ù„ */
    @keyframes glowEffect {
        0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
        100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.7); }
    }

    /* Ù¾Ù„ÛŒØ± ØºÛŒØ±ÙØ¹Ø§Ù„ */
    .player-box.inactive {
        opacity: 0.6;
        filter: grayscale(40%);
        transform: scale(0.98);
    }

    /* Ø¹Ù†ÙˆØ§Ù† Ù¾Ù„ÛŒØ± */
    .player-title {
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 7px;
    }

    /* Ø±Ù†Ú¯ Ø¹Ù†ÙˆØ§Ù† Ù‡Ø± Ù¾Ù„ÛŒØ± */
    .player1 .player-title {
        color: #FFD700; /* Ø·Ù„Ø§ÛŒÛŒ */
        text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
    }
    .player2 .player-title {
        color: #00FF7F; /* Ø³Ø¨Ø² */
        text-shadow: 0 0 8px rgba(0, 255, 127, 0.5);
    }

    /* Ø¢ÛŒÚ©ÙˆÙ† Ù¾Ù„ÛŒØ±Ù‡Ø§ */
    .player1 .player-title::before {
        content: 'ğŸ‘‘'; /* ØªØ§Ø¬ Ø¨Ø±Ø§ÛŒ Ù¾Ù„ÛŒØ± 1 */
    }
    .player2 .player-title::before {
        content: 'âš”ï¸'; /* Ø´Ù…Ø´ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù¾Ù„ÛŒØ± 2 */
    }

    /* ======================================= */
    /* â±ï¸ Ø¨Ø®Ø´ ØªØ§ÛŒÙ…Ø± - Ø¨Ø§ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯         */
    /* ======================================= */
    
    /* Ù†Ù…Ø§ÛŒØ´Ú¯Ø± ØªØ§ÛŒÙ…Ø± */
    .player-timer {
        font-size: 18px;
        font-weight: bold;
        padding: 6px 12px;
        border-radius: 8px;
        color: #000;
        min-width: 42px;
        text-align: center;
        font-family: 'Courier New', monospace;
        border: 2px solid rgba(255, 255, 255, 0.3);
        animation: pulse 1s infinite;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ØªÙ¾Ø´ */
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* ØªØ§ÛŒÙ…Ø± Ù¾Ù„ÛŒØ± 1 - Ø²Ø±Ø¯ */
    .player1 .player-timer {
        background: linear-gradient(135deg, #FFD700, #FFA500); /* Ø·Ù„Ø§ÛŒÛŒ Ø¨Ù‡ Ù†Ø§Ø±Ù†Ø¬ÛŒ */
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    }

    /* ØªØ§ÛŒÙ…Ø± Ù¾Ù„ÛŒØ± 2 - Ø³Ø¨Ø² */
    .player2 .player-timer {
        background: linear-gradient(135deg, #00FF7F, #00CC66); /* Ø³Ø¨Ø² Ø¨Ù‡ Ø³Ø¨Ø² ØªÛŒØ±Ù‡ */
        box-shadow: 0 4px 15px rgba(0, 255, 127, 0.4);
    }

    /* ØªØ§ÛŒÙ…Ø± ÙØ¹Ø§Ù„ (Ù¾Ù„ÛŒØ± Ø¬Ø§Ø±ÛŒ) */
    .player-timer.active {
        animation: heartbeat 1s infinite;
        font-weight: 900;
    }

    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ØªÙ¾Ø´ Ù‚Ù„Ø¨ */
    @keyframes heartbeat {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    /* Ø­Ø§Ù„Øª Ù‡Ø´Ø¯Ø§Ø± (10 Ø«Ø§Ù†ÛŒÙ‡ Ø¢Ø®Ø±) */
    .player-timer.warning {
        background: linear-gradient(135deg, #FF3333, #CC0000) !important;
        color: white !important;
        font-size: 18px;
        animation: warningPulse 0.5s infinite alternate;
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.7) !important;
    }

    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù‡Ø´Ø¯Ø§Ø± 10 Ø«Ø§Ù†ÛŒÙ‡ Ø¢Ø®Ø± */
    @keyframes warningPulse {
        0% { transform: scale(1); }
        100% { transform: scale(1.15); }
    }

    /* ======================================= */
    /* ğŸ“Š Ø¨Ø®Ø´ Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª - Ø·Ø±Ø­ Ø¬Ø¯ÛŒØ¯         */
    /* ======================================= */
    
    /* Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª */
    #score-board {
        width: 460px; /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯ØªØ± Ø¨Ø±Ø§ÛŒ Ø·Ø±Ø­ Ø¬Ø¯ÛŒØ¯ */
        background: rgba(30, 30, 46, 0.9);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 9px 21px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.08);
    }

    /* Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„ */
    .score-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    /* Ø¹Ù†ÙˆØ§Ù† Ù‡Ø± Ø³ØªÙˆÙ† 
    .score-column-title {
        font-size: 14px;
        font-weight: bold;
        padding: 8px 15px;
        border-radius: 6px;
        flex: 1;
        text-align: center;
        margin: 0 5px;
    }*/
	.score-column-title {
    font-size: 18px;  /* Ø§Ø² 14px Ø¨Ù‡ 11px */
    font-weight: bold;
    padding: 6px 1px;  /* Ø§Ø² 8px 15px Ø¨Ù‡ 5px 8px */
    border-radius: 1px;
    flex: 1;
    text-align: center;
    margin: 0 2px;  /* Ø§Ø² 5px Ø¨Ù‡ 2px */
    min-width: 0;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}



    /* Ø¹Ù†ÙˆØ§Ù† Ø³ØªÙˆÙ† Ù¾Ù„ÛŒØ± 1 */
    .score-column-title.player1 {
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
        color: #FFD700;
        border: 1px solid rgba(255, 215, 0, 0.3);
    }

    /* Ø¹Ù†ÙˆØ§Ù† Ø³ØªÙˆÙ† Ù¾Ù„ÛŒØ± 2 */
    .score-column-title.player2 {
        background: linear-gradient(135deg, rgba(0, 255, 127, 0.2), rgba(0, 204, 102, 0.1));
        color: #00FF7F;
        border: 1px solid rgba(0, 255, 127, 0.3);
    }

    /* Ø¹Ù†ÙˆØ§Ù† Ø³ØªÙˆÙ† ØªØ§Ø³ */
    .score-column-title.dice {
        background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.1));
        color: #8A2BE2;
        border: 1px solid rgba(138, 43, 226, 0.3);
    }

    /* Ù‡Ø± Ø±Ø¯ÛŒÙ Ø§Ù…ØªÛŒØ§Ø² */
    .score-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        margin-bottom: 6px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.03);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    /* Ø§ÙÚ©Øª Ù‡Ø§ÙˆØ± Ø±ÙˆÛŒ Ø±Ø¯ÛŒÙ */
    .score-row:hover {
        background: linear-gradient(90deg, 
            rgba(138, 43, 226, 0.1), 
            rgba(75, 0, 130, 0.05), 
            rgba(138, 43, 226, 0.1)
        );
        transform: translateY(-2px);
    }

    /* Ø±Ø¯ÛŒÙ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ */
    .score-row.selected {
        background: linear-gradient(90deg, 
            rgba(255, 215, 0, 0.15), 
            rgba(255, 165, 0, 0.1), 
            rgba(255, 215, 0, 0.15)
        );
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        border: 1px solid rgba(255, 215, 0, 0.4);
    }

    /* Ø³Ø·Ù„ÙˆÙ† ØªØµÙˆÛŒØ± ØªØ§Ø³ (ÙˆØ³Ø·) */
    .score-column.dice {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* Ø³ØªÙˆÙ† Ø§Ù…ØªÛŒØ§Ø² */
    .score-column {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 5px;
    }

    /* ØªØµÙˆÛŒØ± ØªØ§Ø³ Ú©ÙˆÚ†Ú© */
    .mini-dice {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        transition: all 0.3s ease;
        cursor: pointer;
        filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
    }

    /* Ø§ÙÚ©Øª Ù‡Ø§ÙˆØ± Ø±ÙˆÛŒ ØªØ§Ø³ */
    .score-row:hover .mini-dice {
        transform: scale(1.15) rotate(10deg);
        filter: drop-shadow(0 5px 10px rgba(255, 215, 0, 0.5));
    }

    /* Ø¬Ø¹Ø¨Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¹Ø¯Ø¯ (Ø§Ù…ØªÛŒØ§Ø²) */
    .value-box {
    width: 60px;  /* Ø§Ø² 85px Ø¨Ù‡ 60px ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù… */
    padding: 6px 8px;  /* Ø§Ø² 8px 10px Ø¨Ù‡ 6px 8px ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù… */
    font-size: 18px;  /* Ø§Ø² 14px Ø¨Ù‡ 12px ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù… */
    border-radius: 8px;
    border: none;
    outline: none;
    text-align: center;
    background: rgba(40, 40, 60, 0.9);
    color: #fff;
    direction: ltr;
    font-weight: bold;
    font-family: 'Courier New', monospace;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}


    /* Ø§Ù…ØªÛŒØ§Ø² Ø«Ø¨Øª Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù¾Ù„ÛŒØ± 1 */
    .value-box.confirmed.player1 {
        background: linear-gradient(135deg, #FFD700, #FFA500);
        color: #000;
        border: 1px solid rgba(255, 215, 0, 0.6);
        box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        font-weight: 900;
    }

    /* Ø§Ù…ØªÛŒØ§Ø² Ø«Ø¨Øª Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù¾Ù„ÛŒØ± 2 */
    .value-box.confirmed.player2 {
        background: linear-gradient(135deg, #00FF7F, #00CC66);
        color: #000;
        border: 1px solid rgba(0, 255, 127, 0.6);
        box-shadow: 0 4px 12px rgba(0, 255, 127, 0.4);
        font-weight: 900;
    }

    /* Ø¬Ø¹Ø¨Ù‡ Ù‚ÙÙ„ Ø´Ø¯Ù‡ (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±) */
    .value-box.locked {
        opacity: 0.5;
        background: rgba(30, 30, 30, 0.8);
        color: #888;
    }

    /* ======================================= */
    /* ğŸ² Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ (ØªØ§Ø³â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§)     */
    /* ======================================= */
    
    /* Ø¬Ø¹Ø¨Ù‡ Ø§ØµÙ„ÛŒ Ù…Ø±Ú©Ø²ÛŒ */
    #main-box {
        background: rgba(30, 30, 46, 0.9);
        padding: 15px;
        border-radius: 12px;
        width: 450px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Ú©Ø§Ù†ØªÛŒÙ†Ø± ØªØ§Ø³â€ŒÙ‡Ø§ÛŒ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ */
    #dice-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 15px 0;
        width: 100%;
        min-height: 54px;
    }

    /* ØµØ­Ù†Ù‡ Ù‡Ø± ØªØ§Ø³ */
        /* ØµØ­Ù†Ù‡ Ù‡Ø± ØªØ§Ø³ */
    .scene {
        perspective: 600px;
        width: 51px;
        height: 51px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        position: relative;
        border-radius: 8px;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
        background: rgba(255, 255, 255, 0.05);  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
        padding: 2px;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
    }

    /* ØªØ§Ø³ Ù‚ÙÙ„ Ø´Ø¯Ù‡ */
    .scene.locked {
        border: 2px solid rgba(255, 215, 0, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
    }

    /* Ø¢ÛŒÚ©ÙˆÙ† Ù‚ÙÙ„ Ø±ÙˆÛŒ ØªØ§Ø³ */
    .scene.locked::before {
        content: 'ğŸ”’';
        position: absolute;
        top: -9px;
        right: -9px;
        font-size: 14px;
        z-index: 100;
        filter: drop-shadow(0 0 5px gold);
    }

    /* Ù…Ú©Ø¹Ø¨ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ ØªØ§Ø³ */
    .cube {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 1s cubic-bezier(.2,.9,.3,1);
        transform: rotateX(-20deg) rotateY(20deg);
    }

    /* Ù‡Ø± ÙˆØ¬Ù‡ ØªØ§Ø³ */
        /* Ù‡Ø± ÙˆØ¬Ù‡ ØªØ§Ø³ */
    .face {
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: linear-gradient(145deg, #2a0845, #1a0a3e);
        backface-visibility: hidden;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.3);  /* ØªØºÛŒÛŒØ± Ø§Ø² 0.15 Ø¨Ù‡ 0.3 */
        box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.2);  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
    }
    /* Ù†Ù‚Ø§Ø· Ø±ÙˆÛŒ ÙˆØ¬Ù‡ ØªØ§Ø³ */
    .pip {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        position: relative;
        z-index: 2;
        box-shadow: 0 0 6px currentColor;
    }

    /* Ø±Ù†Ú¯ Ù†Ù‚Ø§Ø· Ù‡Ø± ÙˆØ¬Ù‡ */
    .face.f1 .pip { background:#ff0033 !important; color:#ff0033 }
    .face.f2 .pip { background:#ffee55 !important; color:#ffee55 }
    .face.f3 .pip { background:#4ecbff !important; color:#4ecbff }
    .face.f4 .pip { background:#83ff4e !important; color:#83ff4e }
    .face.f5 .pip { background:#ff4ebd !important; color:#ff4ebd }
    .face.f6 .pip { background:#4efbff !important; color:#4efbff }

    /* Ú¯Ø±ÛŒØ¯ 3x3 Ø¨Ø±Ø§ÛŒ Ú†ÛŒØ¯Ù…Ø§Ù† Ù†Ù‚Ø§Ø· */
    .grid3 {
        width: 80%;
        height: 80%;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 6%;
        align-items: center;
        justify-items: center;
    }

    /* Ù…ÙˆÙ‚Ø¹ÛŒØª Ù‡Ø± ÙˆØ¬Ù‡ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ */
    .f1 { transform: rotateX(90deg) translateZ(25.5px); }
    .f2 { transform: rotateY(90deg) translateZ(25.5px); }
    .f3 { transform: rotateY(0deg) translateZ(25.5px); }
    .f4 { transform: rotateY(180deg) translateZ(25.5px); }
    .f5 { transform: rotateY(-90deg) translateZ(25.5px); }
    .f6 { transform: rotateX(-90deg) translateZ(25.5px); }

    /* ======================================= */
    /* ğŸ® Ø¨Ø®Ø´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ                   */
    /* ======================================= */
    
    /* Ø±Ø¯ÛŒÙ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    #button-row {
        display: flex;
        gap: 18px;
        margin-top: 15px;
        width: 100%;
        justify-content: center;
    }

    /* Ø¯Ú©Ù…Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø§Ø²ÛŒ */
    .game-btn {
        padding: 10px 30px;
        font-size: 20px;
        cursor: pointer;
        border: none;
        border-radius: 10px;
        font-weight: bold;
        transition: all 0.3s ease;
        min-width: 90px;
        text-align: center;
        font-family: 'Vazirmatn', sans-serif;
        position: relative;
        overflow: hidden;
    }

    /* Ø§ÙÚ©Øª Ø¯Ø±Ø®Ø´Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    .game-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.7s;
    }

    .game-btn:hover::before {
        left: 100%;
    }

    /* Ø¯Ú©Ù…Ù‡ Ø±ÙˆÙ„ (ØªØ§Ø³ Ø±ÛŒØ®ØªÙ†) */
    #roll-btn {
        background: linear-gradient(135deg, #FF0080, #FF3399);
        color: white;
        box-shadow: 0 6px 18px rgba(255, 0, 128, 0.4);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    /* Ø¯Ú©Ù…Ù‡ Ù¾Ù„ÛŒ (Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø²) */
    #play-btn {
        background: linear-gradient(135deg, #6600cc, #9933ff);
        color: white;
        box-shadow: 0 6px 18px rgba(102, 0, 204, 0.4);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    /* Ø§ÙÚ©Øª Ù‡Ø§ÙˆØ± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    .game-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    /* Ø¯Ú©Ù…Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ */
    .game-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
        background: linear-gradient(135deg, #666, #444);
    }

    /* ======================================= */
    /* ğŸ† Ø¨Ø®Ø´ Ù†ØªØ§ÛŒØ¬ Ù¾Ø§ÛŒØ§Ù†ÛŒ                    */
    /* ======================================= */
    
    /* ØµÙØ­Ù‡ Ù†ØªØ§ÛŒØ¬ */
    .results-screen {
        background: rgba(20, 20, 40, 0.95);
        padding: 24px;
        border-radius: 15px;
        width: 480px;
        box-shadow: 0 15px 36px rgba(0, 0, 0, 0.5);
        text-align: center;
        border: 2px solid rgba(138, 43, 226, 0.4);
        display: none;
        margin-top: 15px;
        backdrop-filter: blur(10px);
    }

    /* Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡ Ù†ØªØ§ÛŒØ¬ */
    .results-title {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 18px;
        color: #ffcc00;
        text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    /* ======================================= */
    /* ğŸ“± Ø¨Ø®Ø´ Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ (Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ ØªØ¨Ù„Øª)        */
    /* ======================================= */
    
    /* ØªØ¨Ù„Øª Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ */
        /* ØªØ¨Ù„Øª Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ */
        /* ØªØ¨Ù„Øª Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ */
    @media (max-width: 768px) {
        body {
            padding: 8px;
        }
        
        #top-wrapper {
            flex-direction: row;
            flex-wrap: nowrap;  /* ØªØºÛŒÛŒØ± Ø¨Ù‡ nowrap */
            justify-content: space-between;  /* ØªØºÛŒÛŒØ± Ø¨Ù‡ space-between */
            gap: 5px;
            width: 100%;
        }
        
        .player-box {
            width: 48%;  /* Ø³Ø§Ø¯Ù‡â€ŒØªØ± */
            min-width: 140px;
            padding: 6px 8px;
            flex: 1;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
        }
        
        .player-title {
            font-size: 14px;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
        }
        
        .player-timer {
            font-size: 12px;  /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… */
            padding: 3px 6px;
            min-width: 28px;
        }
        
        #score-board {
            width: 100%;
            max-width: 100%;
            padding: 10px;
        }
        
        .score-header {
            flex-direction: row;
            gap: 3px;
        }
        
        .score-column-title {
            margin: 0 1px;
            font-size: 13px;
            padding: 5px 9px;
        }
		.value-box {
            width: 75px;
            padding: 8px 10px;
            font-size: 16px;
        }
        
        .mini-dice {
            width: 40px;
            height: 40px;
        }

        .pip {
            width: 7px;  /* Ø§ÙØ²Ø§ÛŒØ´ Ø§Ø² 5px */
            height: 7px;  /* Ø§ÙØ²Ø§ÛŒØ´ Ø§Ø² 5px */
        } 
        #main-box {
            width: 100%;
            max-width: 100%;
            padding: 10px;
        }
        
        #dice-container {
            gap: 8px;
        }
        
        .scene {
            width: 50px;
            height: 50px;
        }
        
        .game-btn {
            padding: 14px 28px;
            font-size: 18px;
            min-width: 120px;
			 width: auto;

        }
        
        .results-screen {
            width: 100%;
            padding: 15px;
        }
    }
    /* Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
    


    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ */
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    @keyframes scorePop {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    /* Ù†Ø´Ø§Ù†Ú¯Ø± Ù†ÙˆØ¨Øª */
    .turn-indicator {
        position: absolute;
        top: -10px;
        right: 50%;
        transform: translateX(50%);
        background: linear-gradient(135deg, #FFD700, #FFA500);
        color: #000;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
        animation: pulse 1s infinite;
        z-index: 10;
        display: none;
    }

    .player-box.active-player .turn-indicator {
        display: block;
    }

    /* Ù¾ÛŒØ§Ù… Ù†ÙˆØ¨Øª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡ */
    .turn-lost-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 0, 0, 0.9);
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        z-index: 1000;
        animation: fadeInOut 2s forwards;
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
        text-align: center;
    }

    @keyframes fadeInOut {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    }
</style>
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
</head>
<body>

<!-- ======================================= -->
<!-- ğŸ—ï¸ Ø³Ø§Ø®ØªØ§Ø± HTML Ø¨Ø§Ø²ÛŒ                    -->
<!-- ======================================= -->

<div id="game-container">
    <!-- Ø¨Ø®Ø´ Ø¨Ø§Ù„Ø§ÛŒÛŒ: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ù„ÛŒØ±Ù‡Ø§ -->
    <div id="top-wrapper">
        <!-- Ù¾Ù„ÛŒØ± 1 -->
        <div id="playerBox1" class="player-box player1 active-player">
            <div class="turn-indicator">Ù†ÙˆØ¨Øª Ø´Ù…Ø§</div>
            <div class="player-title">Ø¨Ø§Ø²ÛŒÚ©Ù† Û±</div>
            <div id="player1Timer" class="player-timer active">Û³Û°</div>
        </div>
        <!-- Ù¾Ù„ÛŒØ± 2 -->
        <div id="playerBox2" class="player-box player2 inactive">
            <div class="turn-indicator">Ù†ÙˆØ¨Øª Ø´Ù…Ø§</div>
            <div class="player-title">Ø¨Ø§Ø²ÛŒÚ©Ù† Û²</div>
            <div id="player2Timer" class="player-timer">Û³Û°</div>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø¨Ø§ Ø·Ø±Ø­ Ø¬Ø¯ÛŒØ¯ -->
    <div id="score-board">
        <div class="score-header">
            <div class="score-column-title player1">Ø¨Ø§Ø²ÛŒÚ©Ù† Û±</div>
            <div class="score-column-title dice">ØªØ§Ø³</div>
            <div class="score-column-title player2">Ø¨Ø§Ø²ÛŒÚ©Ù† Û²</div>
        </div>
        <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ ØªÙˆØ³Ø· Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
    </div>

    <!-- Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ -->
    <div id="main-box">
        <!-- ØªØ§Ø³â€ŒÙ‡Ø§ÛŒ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ -->
        <div id="dice-container"></div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
        <div id="button-row">
            <button id="roll-btn" class="game-btn">ØªØ§Ø³ Ø¨Ø±ÛŒØ²</button>
            <button id="play-btn" class="game-btn" disabled>Ø«Ø¨Øª Ú©Ù†</button>
        </div>
    </div>

    <!-- ØµÙØ­Ù‡ Ù†ØªØ§ÛŒØ¬ -->
    <div id="results-screen" class="results-screen">
        <div class="results-title">ğŸ† Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ</div>
        <div class="results-columns" id="resultsColumns"></div>
        <button id="restart-btn" class="game-btn" style="margin-top: 18px; background: linear-gradient(135deg, #00cc66, #00994d);">
            Ø¨Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
        </button>
    </div>
</div>

<!-- ======================================= -->
<!-- ğŸ”Š Ø¨Ø®Ø´ ØµØ¯Ø§Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ                      -->
<!-- ======================================= -->

<audio id="diceSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/tasandakhtan.wav"></audio>
<audio id="lockSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/ghofl.wav"></audio>
<audio id="selectSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/ghofl.wav"></audio>
<audio id="confirmSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/sabt.wav"></audio>
<audio id="timeoutSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/sabt.wav"></audio>
<audio id="warningSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/ghofl.wav"></audio>
<audio id="tickSound" src="https://raw.githubusercontent.com/nonacoin/main/main/Dice/ghofl.wav"></audio>

<script>
/* ======================================= */
/* ğŸ¯ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ                   */
/* ======================================= */

// ØµØ¯Ø§Ù‡Ø§
const diceSound = document.getElementById('diceSound');
const lockSound = document.getElementById('lockSound');
const selectSound = document.getElementById('selectSound');
const confirmSound = document.getElementById('confirmSound');
const timeoutSound = document.getElementById('timeoutSound');
const warningSound = document.getElementById('warningSound');
const tickSound = document.getElementById('tickSound');

[diceSound, lockSound, selectSound, confirmSound, timeoutSound, warningSound, tickSound].forEach(sound => {
    sound.volume = 0.7;
    sound.preload = 'auto';
});

const baseURL = "https://raw.githubusercontent.com/nonacoin/main/main/Dice/";

// ============================================
// ğŸŸ¢ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒ Ø§Ø² URL
// ============================================
const urlParams = new URLSearchParams(window.location.search);
const gameData = {
    game_id: urlParams.get('game_id') || "DEMO_GAME",
    telegram_id: parseInt(urlParams.get('telegram_id')) || 0,
    player_number: parseInt(urlParams.get('player')) || 1,
    role: "player",
    status: "waiting"
};

// ============================================
// ğŸŸ¢ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø§Ø²ÛŒ
// ============================================
let gameState = {
    currentPlayer: 1,
    rollCount: 0,
    maxRolls: 3,
    selectedCategory: null,
    confirmedCategories: {
        player1: Array(6).fill(null),
        player2: Array(6).fill(null)
    },
    gameFinished: false,
    specialBonuses: { player1: 0, player2: 0 }
};

let diceData = [
  { id: 0, locked: false, value: Math.floor(Math.random() * 6) + 1 },
  { id: 1, locked: false, value: Math.floor(Math.random() * 6) + 1 },
  { id: 2, locked: false, value: Math.floor(Math.random() * 6) + 1 },
  { id: 3, locked: false, value: Math.floor(Math.random() * 6) + 1 },
  { id: 4, locked: false, value: Math.floor(Math.random() * 6) + 1 }
];

let isRolling = false;
let timerInterval = null;
let timeLeft = 30;
const TOTAL_TIME = 30;

// ============================================
// ğŸŸ¢ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ØªØ§Ø³
// ============================================
const facePips = {
  1: [5], 2: [1,9], 3: [1,5,9], 4: [1,3,7,9], 5: [1,3,5,7,9], 6: [1,3,4,6,7,9]
};

const rotations = {
  1: {x: -90, y: 0}, 2: {x: 0, y: -90}, 3: {x: 0, y: 0},
  4: {x: 0, y: 180}, 5: {x: 0, y: 90}, 6: {x: 90, y: 0}
};

function rand1to6(){ 
    return Math.floor(Math.random() * 6) + 1; 
}

function calculatePotentialScores() {
    const scores = Array(6).fill(0);
    for (let category = 1; category <= 6; category++) {
        scores[category-1] = diceData
            .filter(dice => dice.value === category)
            .reduce((sum, dice) => sum + dice.value, 0);
    }
    return scores;
}

// ============================================
// ğŸŸ¢ ØªØ§Ø¨Ø¹ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± (GAS)
// ============================================
async function callServer(action, data = {}) {
    try {
        const GAS_URL = "https://script.google.com/macros/s/AKfycbxLuX7sDcICugvh0YiXL3Hzep_rxpy18AU_ZNaoUcAf3Ip2r5mOmLUDb2MCNedvddavPw/exec";
        
        const response = await fetch(GAS_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                action: action,
                ...data,
                game_id: gameData.game_id,
                telegram_id: gameData.telegram_id
            })
        });
        
        return await response.json();
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±:', error);
        return {error: true, message: "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±"};
    }
}

// ============================================
// ğŸŸ¢ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ Ø§Ø² Ø³Ø±ÙˆØ±
// ============================================
async function loadGameFromServer() {
    console.log("ğŸ“¡ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ Ø§Ø² Ø³Ø±ÙˆØ±...");
    
    const result = await callServer('getGameState');
    console.log("âœ… Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ±:", result);
    
    if (!result.success) {
        console.log("âŒ Ø®Ø·Ø§ Ø§Ø² Ø³Ø±ÙˆØ±:", result.message);
        if (result.setup_required) {
            alert("âš ï¸ Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§ Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.");
        }
        return;
    }
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒ
    gameData.role = result.role || "player";
    gameData.status = result.status || "waiting";
    gameData.player_number = result.player_number || gameData.player_number;
    
    console.log("ğŸ® ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ:", gameData);
    
    // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ waiting Ø§Ø³Øª Ùˆ ØªÙˆ Ù¾Ù„ÛŒØ± Û± Ù‡Ø³ØªÛŒ
    if (gameData.status === "waiting" && gameData.player_number === 1) {
        document.getElementById("roll-btn").disabled = true;
        document.getElementById("play-btn").disabled = true;
        
        const waitMsg = document.createElement('div');
        waitMsg.id = "waiting-message";
        waitMsg.innerHTML = `
            <div style="background:rgba(255,215,0,0.2); padding:15px; border-radius:10px; text-align:center; margin:10px;">
                <div style="font-size:18px; color:#FFD700;">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯ÙˆÙ…...</div>
                <div style="font-size:14px; margin-top:10px;">Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª: ${window.location.href}</div>
            </div>
        `;
        document.querySelector('#game-container').prepend(waitMsg);
    }
    
    // Ø§Ú¯Ø± ØªÙ…Ø§Ø´Ø§Ú¯Ø± Ù‡Ø³ØªÛŒ
    if (gameData.role === "spectator") {
        disablePlayerControls();
        
        const specMsg = document.createElement('div');
        specMsg.innerHTML = `
            <div style="background:rgba(138,43,226,0.2); padding:10px; border-radius:8px; text-align:center; margin:10px;">
                ğŸ‘ï¸ <b>Ø­Ø§Ù„Øª ØªÙ…Ø§Ø´Ø§Ú¯Ø±</b> - Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ø§Ø²ÛŒ Ù‡Ø³ØªÛŒØ¯
            </div>
        `;
        document.querySelector('#game-container').prepend(specMsg);
    }
    
    // Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…Ø§ÛŒØ´
    updateTurnDisplay();
    
    // Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø± Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ playing Ø§Ø³Øª
    if (gameData.status === "playing") {
        startTimer();
    }
}

// ============================================
// ğŸŸ¢ ØªØ§Ø¨Ø¹ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ spectator
// ============================================
function disablePlayerControls() {
    document.getElementById("roll-btn").disabled = true;
    document.getElementById("play-btn").disabled = true;
    
    document.querySelectorAll('.scene').forEach(scene => {
        scene.style.pointerEvents = 'none';
    });
    
    document.querySelectorAll('.score-row').forEach(row => {
        row.style.pointerEvents = 'none';
    });
    
    const msg = document.createElement('div');
    msg.textContent = 'ğŸ‘ï¸ Ø­Ø§Ù„Øª ØªÙ…Ø§Ø´Ø§Ú¯Ø± - Ø´Ù…Ø§ ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯';
    msg.style.cssText = 'background:rgba(0,0,0,0.7);color:white;padding:10px;border-radius:5px;margin:10px;text-align:center;';
    document.querySelector('#game-container').prepend(msg);
}

// ============================================
// ğŸŸ¢ ØªØ§Ø¨Ø¹ refresh Ø®ÙˆØ¯Ú©Ø§Ø±
// ============================================
function setupAutoRefresh() {
    console.log("ğŸ”„ ØªÙ†Ø¸ÛŒÙ… Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª:", gameData.status);
    
    if (gameData.status === "waiting" && gameData.player_number === 1) {
        console.log("âœ… Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯ (Ù‡Ø± 5 Ø«Ø§Ù†ÛŒÙ‡)");
        
        const refreshInterval = setInterval(async () => {
            console.log("ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯ÙˆÙ…...");
            const result = await callServer('getGameState');
            
            if (result.success && result.status === "playing") {
                console.log("ğŸ‰ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯ÙˆÙ… Ù¾ÛŒÙˆØ³Øª!");
                
                gameData.status = "playing";
                
                const waitMsg = document.getElementById("waiting-message");
                if (waitMsg) waitMsg.remove();
                
                document.getElementById("roll-btn").disabled = false;
                
                alert("ğŸ® Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯ÙˆÙ… Ù¾ÛŒÙˆØ³Øª! Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯!");
                
                clearInterval(refreshInterval);
                setTimeout(() => location.reload(), 1000);
            }
        }, 5000);
    }
}

// ============================================
// ğŸŸ¢ Ø³ÛŒØ³ØªÙ… ØªØ§ÛŒÙ…Ø±
// ============================================
function startTimer() {
    if (gameState.gameFinished) return;
    
    clearInterval(timerInterval);
    timeLeft = TOTAL_TIME;
    updateTimerDisplay();
    
    timerInterval = setInterval(() => {
        if (gameState.gameFinished) { 
            clearInterval(timerInterval); 
            return; 
        }
        
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
            timeUp();
        }
    }, 1000);
}

function updateTimerDisplay() {
    const p1 = document.getElementById('player1Timer');
    const p2 = document.getElementById('player2Timer');
    
    if (gameState.currentPlayer === 1) {
        p1.textContent = timeLeft;
        p1.classList.add('active');
        p2.textContent = TOTAL_TIME;
        p2.classList.remove('active');
    } else {
        p2.textContent = timeLeft;
        p2.classList.add('active');
        p1.textContent = TOTAL_TIME;
        p1.classList.remove('active');
    }
}

function timeUp() {
    clearInterval(timerInterval);
    timeoutSound.currentTime = 0;
    timeoutSound.play();
    
    // Ù…Ù†Ø·Ù‚ timeout Ø¨Ø§Ø²ÛŒ
    if (gameState.selectedCategory) {
        const { player, rowIndex } = gameState.selectedCategory;
        const playerKey = `player${player}`;
        const potentialScores = calculatePotentialScores();
        const score = potentialScores[rowIndex];
        gameState.confirmedCategories[playerKey][rowIndex] = score;
    }
    
    checkGameCompletion();
}

// ============================================
// ğŸŸ¢ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ù†ÙˆØ¨Øª
// ============================================
function updateTurnDisplay() {
    const left = document.getElementById('playerBox1');
    const right = document.getElementById('playerBox2');
    const leftTitle = left.querySelector('.player-title');
    const rightTitle = right.querySelector('.player-title');
    
    if (gameData.player_number === 1) {
        leftTitle.textContent = "Ø´Ù…Ø§ ğŸ‘‘";
        rightTitle.textContent = "Ø­Ø±ÛŒÙ âš”ï¸";
    } else if (gameData.player_number === 2) {
        leftTitle.textContent = "Ø­Ø±ÛŒÙ âš”ï¸";
        rightTitle.textContent = "Ø´Ù…Ø§ ğŸ‘‘";
    } else {
        leftTitle.textContent = "Ø¨Ø§Ø²ÛŒÚ©Ù† 1";
        rightTitle.textContent = "Ø¨Ø§Ø²ÛŒÚ©Ù† 2";
    }
    
    if (gameState.currentPlayer === 1) {
        left.classList.remove('inactive');
        left.classList.add('active-player');
        right.classList.remove('active-player');
        right.classList.add('inactive');
    } else {
        right.classList.remove('inactive');
        right.classList.add('active-player');
        left.classList.remove('active-player');
        left.classList.add('inactive');
    }
    
    updateTimerDisplay();
}

// ============================================
// ğŸŸ¢ Ø±Ù†Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª
// ============================================
function renderScoreBoard() {
    const container = document.getElementById('score-board');
    const existingHeader = container.querySelector('.score-header');
    container.innerHTML = '';
    container.appendChild(existingHeader);
    
    for (let i = 1; i <= 6; i++) {
        const row = document.createElement('div');
        row.className = `score-row`;
        row.dataset.category = i-1;
        row.dataset.value = i;

        const col1 = document.createElement('div');
        col1.className = 'score-column';
        const input1 = document.createElement('input');
        input1.type = 'text';
        input1.className = 'value-box';
        input1.readOnly = true;
        input1.dataset.player = '1';
        input1.value = '0';
        col1.appendChild(input1);

        const colDice = document.createElement('div');
        colDice.className = 'score-column dice';
        const img = document.createElement('img');
        img.src = baseURL + i + '.png';
        img.className = 'mini-dice';
        img.alt = `ØªØ§Ø³ ${i}`;
        colDice.appendChild(img);

        const col2 = document.createElement('div');
        col2.className = 'score-column';
        const input2 = document.createElement('input');
        input2.type = 'text';
        input2.className = 'value-box';
        input2.readOnly = true;
        input2.dataset.player = '2';
        input2.value = '0';
        col2.appendChild(input2);

        row.appendChild(col1);
        row.appendChild(colDice);
        row.appendChild(col2);

        row.addEventListener('click', () => {
            if (gameState.gameFinished) return;
            if (gameState.rollCount === 0) return;
            
            const idx = parseInt(row.dataset.category, 10);
            const playerKey = `player${gameState.currentPlayer}`;
            
            if (gameState.confirmedCategories[playerKey][idx] !== null) {
                return;
            }

            document.querySelectorAll('#score-board .score-row.selected').forEach(r => {
                r.classList.remove('selected');
            });
            
            row.classList.add('selected');
            gameState.selectedCategory = { 
                player: gameState.currentPlayer, 
                rowIndex: idx 
            };
            
            selectSound.currentTime = 0;
            selectSound.play();
            
            document.getElementById('play-btn').disabled = false;
        });

        container.appendChild(row);
    }
    updateScoreDisplays();
}

function updateScoreDisplays() {
    if (gameState.gameFinished) return;
    const potential = calculatePotentialScores();

    const rows = document.querySelectorAll('#score-board .score-row');
    rows.forEach((row, index) => {
        const input1 = row.querySelector('.value-box[data-player="1"]');
        const input2 = row.querySelector('.value-box[data-player="2"]');

        const conf1 = gameState.confirmedCategories.player1[index];
        const conf2 = gameState.confirmedCategories.player2[index];

        if (conf1 !== null) {
            input1.value = conf1;
            input1.classList.add('confirmed','player1');
        } else {
            if (gameState.currentPlayer === 1) {
                input1.value = potential[index] || 0;
                input1.classList.remove('confirmed','player1');
            } else {
                input1.value = 'â€”';
            }
        }

        if (conf2 !== null) {
            input2.value = conf2;
            input2.classList.add('confirmed','player2');
        } else {
            if (gameState.currentPlayer === 2) {
                input2.value = potential[index] || 0;
                input2.classList.remove('confirmed','player2');
            } else {
                input2.value = 'â€”';
            }
        }
    });
}

// ============================================
// ğŸŸ¢ Ø±Ù†Ø¯Ø± ØªØ§Ø³â€ŒÙ‡Ø§ÛŒ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ
// ============================================
function renderDice() {
  const container = document.getElementById('dice-container');
  container.innerHTML = '';

  diceData.forEach((diceItem) => {
    const scene = document.createElement('div');
    scene.className = 'scene';
    if (diceItem.locked) scene.classList.add('locked');
    scene.dataset.id = diceItem.id;

    const cube = document.createElement('div');
    cube.className = 'cube';
    cube.id = `cube${diceItem.id}`;

    for (let f = 1; f <= 6; f++) {
      const face = document.createElement('div');
      face.className = `face f${f}`;
      const grid = document.createElement('div');
      grid.className = 'grid3';
      grid.dataset.face = f;

      for(let j = 1; j <= 9; j++){
        const slot = document.createElement('div');
        slot.style.display = 'flex';
        slot.style.alignItems = 'center';
        slot.style.justifyContent = 'center';
        if(facePips[f].includes(j)){
          const pip = document.createElement('div');
          pip.className = 'pip';
          slot.appendChild(pip);
        }
        grid.appendChild(slot);
      }
      face.appendChild(grid);
      cube.appendChild(face);
    }

    scene.appendChild(cube);
    container.appendChild(scene);

    const rot = rotations[diceItem.value];
    cube.style.transform = `rotateX(${rot.x}deg) rotateY(${rot.y}deg)`;

    scene.addEventListener('click', () => {
      if (isRolling) return;
      if (gameState.rollCount === 0) return;
      if (gameState.gameFinished) return;

      const idx = diceData.findIndex(d => d.id === diceItem.id);
      if (idx === -1) return;
      
      diceData[idx].locked = !diceData[idx].locked;

      lockSound.currentTime = 0;
      lockSound.play();

      if (diceData[idx].locked) {
        scene.classList.add('locked');
      } else {
        scene.classList.remove('locked');
      }
      
      updateScoreDisplays();
    });
  });
}

// ============================================
// ğŸŸ¢ Ø¯Ú©Ù…Ù‡ Ø±ÙˆÙ„ (ØªØ§Ø³ Ø±ÛŒØ®ØªÙ†)
// ============================================
document.getElementById("roll-btn").addEventListener("click", async () => {
  if (isRolling) return;
  if (gameState.rollCount >= gameState.maxRolls) return;
  if (gameState.gameFinished) return;

  isRolling = true;
  const btn = document.getElementById("roll-btn");
  btn.disabled = true;
  
  gameState.selectedCategory = null;
  document.querySelectorAll('#score-board .score-row.selected').forEach(r => {
    r.classList.remove('selected');
  });
  document.getElementById('play-btn').disabled = true;

  const unlockedIndices = diceData
    .map((d, idx) => !d.locked ? idx : -1)
    .filter(idx => idx !== -1);

  if (unlockedIndices.length > 0) {
    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆÙ„ - Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ø§ Ø³Ø±ÙˆØ± Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯
    diceData.forEach((dice, idx) => {
      if (!dice.locked) {
        dice.value = rand1to6();
      }
    });
  }

  gameState.rollCount++;
  renderDice();
  updateScoreDisplays();

  if (gameState.rollCount >= gameState.maxRolls) {
    btn.disabled = true;
    btn.textContent = "Û³ Ø¨Ø§Ø± Ø±ÙˆÙ„ Ú©Ø±Ø¯ÛŒØ¯";
  } else {
    btn.disabled = false;
    btn.textContent = `ØªØ§Ø³ Ø¨Ø±ÛŒØ² (${3 - gameState.rollCount})`;
  }

  isRolling = false;
});

// ============================================
// ğŸŸ¢ Ø¯Ú©Ù…Ù‡ Ù¾Ù„ÛŒ (Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø²)
// ============================================
document.getElementById("play-btn").addEventListener("click", function() {
    if (!gameState.selectedCategory) return;
    if (gameState.gameFinished) return;

    const { player, rowIndex } = gameState.selectedCategory;
    const playerKey = `player${player}`;
    const potentialScores = calculatePotentialScores();
    const score = potentialScores[rowIndex];

    gameState.confirmedCategories[playerKey][rowIndex] = score;
    
    confirmSound.currentTime = 0;
    confirmSound.play();
    
    gameState.selectedCategory = null;
    document.querySelectorAll('#score-board .score-row.selected').forEach(r => {
        r.classList.remove('selected');
    });
    
    this.disabled = true;
    checkGameCompletion();
});

// ============================================
// ğŸŸ¢ Ù…Ø¯ÛŒØ±ÛŒØª Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§
// ============================================
function resetDiceForNewTurn() {
    diceData.forEach(d => d.locked = false);
    diceData = [
        { id: 0, locked: false, value: rand1to6() },
        { id: 1, locked: false, value: rand1to6() },
        { id: 2, locked: false, value: rand1to6() },
        { id: 3, locked: false, value: rand1to6() },
        { id: 4, locked: false, value: rand1to6() }
    ];
    gameState.rollCount = 0;
    gameState.selectedCategory = null;
}

function nextTurn() {
    resetDiceForNewTurn();
    gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
    updateTurnDisplay();
    renderDice();
    document.getElementById("play-btn").disabled = true;
    document.getElementById("roll-btn").disabled = false;
    document.getElementById("roll-btn").textContent = "ØªØ§Ø³ Ø¨Ø±ÛŒØ²";
    if (!gameState.gameFinished) startTimer();
    updateScoreDisplays();
}

function checkGameCompletion() {
    const p1filled = gameState.confirmedCategories.player1.every(x=>x!==null);
    const p2filled = gameState.confirmedCategories.player2.every(x=>x!==null);
    if (p1filled && p2filled) {
        gameState.gameFinished = true;
        clearInterval(timerInterval);
        showResultsScreen();
    } else {
        nextTurn();
    }
}

function showResultsScreen() {
    const player1Score = gameState.confirmedCategories.player1.reduce((s, v) => s + (v||0), 0);
    const player2Score = gameState.confirmedCategories.player2.reduce((s, v) => s + (v||0), 0);
    
    const resultsScreen = document.getElementById('results-screen');
    const resultsColumns = document.getElementById('resultsColumns');
    
    resultsColumns.innerHTML = `
        <div style="margin-bottom: 20px;">
            <div style="font-size: 20px; color: #FFD700;">Ø¨Ø§Ø²ÛŒÚ©Ù† 1: ${player1Score} Ø§Ù…ØªÛŒØ§Ø²</div>
            <div style="font-size: 20px; color: #00FF7F;">Ø¨Ø§Ø²ÛŒÚ©Ù† 2: ${player2Score} Ø§Ù…ØªÛŒØ§Ø²</div>
            <div style="font-size: 24px; margin-top: 15px; color: #ffcc00;">
                ${player1Score > player2Score ? 'ğŸ† Ø¨Ø§Ø²ÛŒÚ©Ù† 1 Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!' : 
                  player2Score > player1Score ? 'ğŸ† Ø¨Ø§Ø²ÛŒÚ©Ù† 2 Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!' : 'âš–ï¸ Ù…Ø³Ø§ÙˆÛŒ!'}
            </div>
        </div>
    `;
    
    document.getElementById('main-box').style.display = 'none';
    document.getElementById('score-board').style.display = 'none';
    resultsScreen.style.display = 'block';
}

// ============================================
// ğŸŸ¢ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ
// ============================================
window.addEventListener('DOMContentLoaded', async () => {
    console.log("ğŸš€ ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯");
    
    // Ø§ÙˆÙ„ UI Ø±Ùˆ Ø¨Ø³Ø§Ø²
    renderScoreBoard();
    renderDice();
    updateTurnDisplay();
    
    // Ø³Ù¾Ø³ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ Ø±Ùˆ Ø§Ø² Ø³Ø±ÙˆØ± Ø¨Ú¯ÛŒØ±
    await loadGameFromServer();
    
    // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª
    if (gameData.status === "playing") {
        startTimer();
    } else if (gameData.status === "waiting") {
        setupAutoRefresh();
    }
    
    console.log("âœ… Ø¨Ø§Ø²ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. ÙˆØ¶Ø¹ÛŒØª:", gameData);
});

// ============================================
// ğŸŸ¢ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
// ============================================
document.getElementById('restart-btn').addEventListener('click', function() {
    gameState = {
        currentPlayer: 1, rollCount: 0, maxRolls: 3, selectedCategory: null,
        confirmedCategories: { player1: Array(6).fill(null), player2: Array(6).fill(null) },
        gameFinished: false, specialBonuses: { player1: 0, player2: 0 }
    };
    
    diceData = [
        { id: 0, locked: false, value: rand1to6() },
        { id: 1, locked: false, value: rand1to6() },
        { id: 2, locked: false, value: rand1to6() },
        { id: 3, locked: false, value: rand1to6() },
        { id: 4, locked: false, value: rand1to6() }
    ];
    
    document.getElementById('results-screen').style.display = 'none';
    document.getElementById('main-box').style.display = 'flex';
    document.getElementById('score-board').style.display = 'block';
    
    renderScoreBoard();
    renderDice();
    updateTurnDisplay();
    
    if (gameData.status === "playing") {
        startTimer();
    }
    
    document.getElementById("roll-btn").disabled = false;
    document.getElementById("roll-btn").textContent = "ØªØ§Ø³ Ø¨Ø±ÛŒØ²";
    document.getElementById("play-btn").disabled = true;
});
			</script>
</body>

</html>


