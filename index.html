<!DOCTYPE html>
<html>
<head>
    <title>تست سوپا</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>تست اتصال سوپا</h1>
    
    <div>
        <button onclick="testConnection()">تست اتصال</button>
        <button onclick="readData()">خواندن داده</button>
        <button onclick="writeTest()">نوشتن تست</button>
    </div>
    
    <div id="output"></div>

    <script>
        const supabaseUrl = 'https://xouwoemiyxnugontsles.supabase.co';
        const supabaseKey = 'sb_publishable_MFoTbKuCDjhVCs1-xvKNag_UwhV0tF-';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        function testConnection() {
            document.getElementById('output').innerHTML = 'در حال تست اتصال...';
            
            supabase.from('game_rooms_v0').select('count').limit(1)
                .then(response => {
                    if (response.error) {
                        document.getElementById('output').innerHTML = 'خطا: ' + response.error.message;
                    } else {
                        document.getElementById('output').innerHTML = '✅ اتصال موفق';
                    }
                })
                .catch(error => {
                    document.getElementById('output').innerHTML = 'خطا: ' + error.message;
                });
        }
        
        function readData() {
            document.getElementById('output').innerHTML = 'در حال خواندن...';
            
            Promise.all([
                supabase.from('game_rooms_v0').select('*').limit(5),
                supabase.from('game_room_players_v0').select('*').limit(5)
            ])
            .then(([rooms, players]) => {
                let html = '<h3>داده‌های خوانده شده:</h3>';
                html += '<h4>اتاق‌ها:</h4>';
                html += '<pre>' + JSON.stringify(rooms.data, null, 2) + '</pre>';
                html += '<h4>بازیکنان:</h4>';
                html += '<pre>' + JSON.stringify(players.data, null, 2) + '</pre>';
                
                document.getElementById('output').innerHTML = html;
            })
            .catch(error => {
                document.getElementById('output').innerHTML = 'خطا در خواندن: ' + error.message;
            });
        }
        
        function writeTest() {
            document.getElementById('output').innerHTML = 'در حال نوشتن داده تست...';
            
            const testRoom = {
                room_code: 'TEST_' + Math.random().toString(36).substr(2, 5).toUpperCase(),
                room_status: 'waiting',
                debug_note: 'تست از صفحه HTML - ' + new Date().toISOString()
            };
            
            supabase.from('game_rooms_v0')
                .insert([testRoom])
                .then(response => {
                    if (response.error) {
                        document.getElementById('output').innerHTML = 'خطا در نوشتن: ' + response.error.message;
                    } else {
                        document.getElementById('output').innerHTML = 
                            '✅ نوشتن موفق<br>داده ایجاد شده:<br><pre>' + 
                            JSON.stringify(response.data[0], null, 2) + '</pre>';
                    }
                })
                .catch(error => {
                    document.getElementById('output').innerHTML = 'خطا: ' + error.message;
                });
        }
    </script>
</body>
</html>
